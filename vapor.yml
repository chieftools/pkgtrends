id: 2993
name: pkgtrends
environments:
  production:
    domain: pkgtrends.app
    network: irongate
    gateway-version: 1

    runtime: php-8.1:al2

    database: irongate
    database-user: pkgtrends

    memory: 1024
    timeout: 30
    concurrency: 25

    cli-memory: 512

    queue-memory: 512
    queue-timeout: 600
    queue-concurrency: 25

    build:
      - 'rm -f .env'
      - 'composer install --no-dev --classmap-authoritative'
      - 'php artisan view:cache'
      - 'php artisan event:cache'
      - 'php artisan route:cache'
      - 'yarn install --frozen-lockfile && yarn run prod && rm -rf node_modules'
    deploy:
      - 'php artisan migrate --force'
